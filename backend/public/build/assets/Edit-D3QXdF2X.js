import{u as P,a as j,j as e,L as N,b as B}from"./app-DIo57JqX.js";import{A as R}from"./AdminLayout-CAMTXasa.js";import{a as m}from"./adminPath-BxB_o4uP.js";/* empty css            */const O=a=>{if(!a)return"";const i=new Date(a);if(Number.isNaN(i.getTime()))return"";const d=c=>String(c).padStart(2,"0");return`${i.getFullYear()}-${d(i.getMonth()+1)}-${d(i.getDate())}T${d(i.getHours())}:${d(i.getMinutes())}`};function V({trader:a,assets:i,active_followers:d,followers:c=[],trade_history:y=[]}){const{url:u}=P(),t=j({display_name:a.display_name||"",username:a.username||"",avatar_color:a.avatar_color||"",strategy:a.strategy||"",copy_fee:a.copy_fee??0,total_return:a.total_return??0,win_rate:a.win_rate??0,copiers_count:a.copiers_count??0,risk_score:a.risk_score??1,joined_at:O(a.joined_at),is_verified:!!a.is_verified,is_active:!!a.is_active}),v=i?.[0]??null,s=j({asset_id:v?.id||"",apply_to:"all",copy_relationship_id:"",side:"buy",quantity:"",price:v?.price??"",executed_at:"",pnl:"",note:""}),n=j({trade_id:"",pnl:""}),C=r=>{r.preventDefault(),t.put(m(u,`copy-traders/${a.id}`))},q=()=>{window.confirm("Delete this copy trader? This will remove all related follower relationships.")&&B.delete(m(u,`copy-traders/${a.id}`))},S=r=>{r.preventDefault(),s.post(m(u,`copy-traders/${a.id}/trades`),{preserveScroll:!0,onSuccess:()=>{s.reset("quantity","pnl","note","executed_at")}})},w=r=>{s.setData("asset_id",r);const p=i.find(x=>x.id===r);p&&s.setData("price",p.price)},A=r=>{n.clearErrors(),n.setData({trade_id:r.id,pnl:Number(r?.pnl??0).toFixed(2)})},_=()=>{n.reset("trade_id","pnl"),n.clearErrors()},k=r=>{r.preventDefault(),n.data.trade_id&&n.put(m(u,`copy-traders/${a.id}/trades/${n.data.trade_id}`),{preserveScroll:!0,onSuccess:()=>{_()}})},f=Array.isArray(y)?y:[],L=Array.isArray(c)?c:[],b=s.data.apply_to==="single",$=Number(d||0)>0,T=!!s.data.copy_relationship_id,E=s.processing||(b?!T:!$),U=r=>{s.setData("apply_to",r),r!=="single"&&s.setData("copy_relationship_id","")};return e.jsx(R,{title:`Edit ${a.display_name}`,children:e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[1.2fr,0.8fr]",children:[e.jsxs("section",{className:"rounded-2xl border border-slate-800 bg-slate-900/70 p-4 sm:p-6",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-100",children:"Trader Details"}),e.jsx("p",{className:"mt-1 text-sm text-slate-400",children:"Update copy trader stats and profile info."})]}),e.jsx(N,{href:m(u,"copy-traders"),className:"rounded-xl border border-slate-700 px-4 py-2 text-xs text-slate-200 transition hover:border-slate-500 hover:bg-slate-800",children:"Back to list"})]}),e.jsxs("form",{onSubmit:C,className:"space-y-5",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsx(l,{label:"Display Name",error:t.errors.display_name,required:!0,children:e.jsx("input",{type:"text",value:t.data.display_name,onChange:r=>t.setData("display_name",r.target.value),className:o(t.errors.display_name),required:!0})}),e.jsx(l,{label:"Username",error:t.errors.username,required:!0,children:e.jsx("input",{type:"text",value:t.data.username,onChange:r=>t.setData("username",r.target.value),className:o(t.errors.username),required:!0})}),e.jsx(l,{label:"Avatar Color",error:t.errors.avatar_color,children:e.jsx("input",{type:"text",value:t.data.avatar_color,onChange:r=>t.setData("avatar_color",r.target.value),className:o(t.errors.avatar_color),placeholder:"emerald"})}),e.jsx(l,{label:"Strategy",error:t.errors.strategy,required:!0,children:e.jsx("input",{type:"text",value:t.data.strategy,onChange:r=>t.setData("strategy",r.target.value),className:o(t.errors.strategy),required:!0})})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsx(l,{label:"Copy Fee ($)",error:t.errors.copy_fee,required:!0,children:e.jsx("input",{type:"number",step:"0.01",min:"0",value:t.data.copy_fee,onChange:r=>t.setData("copy_fee",r.target.value),className:o(t.errors.copy_fee),required:!0})}),e.jsx(l,{label:"Total Return (%)",error:t.errors.total_return,required:!0,children:e.jsx("input",{type:"number",step:"0.01",value:t.data.total_return,onChange:r=>t.setData("total_return",r.target.value),className:o(t.errors.total_return),required:!0})}),e.jsx(l,{label:"Win Rate (%)",error:t.errors.win_rate,required:!0,children:e.jsx("input",{type:"number",step:"0.01",value:t.data.win_rate,onChange:r=>t.setData("win_rate",r.target.value),className:o(t.errors.win_rate),required:!0})}),e.jsx(l,{label:"Copiers Count",error:t.errors.copiers_count,required:!0,children:e.jsx("input",{type:"number",step:"1",value:t.data.copiers_count,onChange:r=>t.setData("copiers_count",r.target.value),className:o(t.errors.copiers_count),required:!0})}),e.jsx(l,{label:"Risk Score (1-10)",error:t.errors.risk_score,required:!0,children:e.jsx("input",{type:"number",step:"1",min:"1",max:"10",value:t.data.risk_score,onChange:r=>t.setData("risk_score",r.target.value),className:o(t.errors.risk_score),required:!0})})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:e.jsx(l,{label:"Joined At",error:t.errors.joined_at,required:!0,children:e.jsx("input",{type:"datetime-local",value:t.data.joined_at,onChange:r=>t.setData("joined_at",r.target.value),className:o(t.errors.joined_at),required:!0})})}),e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[e.jsx(D,{label:"Verified",checked:t.data.is_verified,onChange:r=>t.setData("is_verified",r)}),e.jsx(D,{label:"Active",checked:t.data.is_active,onChange:r=>t.setData("is_active",r)})]}),(t.errors.is_verified||t.errors.is_active)&&e.jsx("p",{className:"text-xs text-rose-300",children:t.errors.is_verified||t.errors.is_active}),e.jsxs("div",{className:"flex flex-wrap gap-3 pt-2",children:[e.jsx("button",{type:"submit",disabled:t.processing,className:"rounded-xl bg-gradient-to-r from-cyan-500 to-emerald-500 px-5 py-2.5 text-sm font-semibold text-slate-950 transition hover:opacity-90 disabled:cursor-not-allowed disabled:opacity-60",children:t.processing?"Saving...":"Save Changes"}),e.jsx(N,{href:m(u,"copy-traders"),className:"rounded-xl border border-slate-700 px-5 py-2.5 text-sm text-slate-200 transition hover:border-slate-500 hover:bg-slate-800",children:"Cancel"}),e.jsx("button",{type:"button",onClick:q,className:"rounded-xl border border-rose-500/50 px-5 py-2.5 text-sm font-semibold text-rose-200 transition hover:border-rose-400 hover:bg-rose-500/10",children:"Delete Trader"})]})]})]}),e.jsxs("section",{className:"rounded-2xl border border-slate-800 bg-slate-900/70 p-4 sm:p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-100",children:"Execute Copy Trade"}),e.jsxs("p",{className:"mt-1 text-sm text-slate-400",children:[b?"Apply this trade history entry to one copied user.":`Applies the trade to ${d} active follower${d===1?"":"s"}.`," ","Quantity and PnL scale by each follower's copy ratio."]})]}),e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsx(l,{label:"Apply To",error:s.errors.apply_to,required:!0,children:e.jsxs("select",{value:s.data.apply_to,onChange:r=>U(r.target.value),className:o(s.errors.apply_to),required:!0,children:[e.jsxs("option",{value:"all",children:["All active followers (",d||0,")"]}),e.jsx("option",{value:"single",children:"One copied user"})]})}),b?e.jsx(l,{label:"Copied User",error:s.errors.copy_relationship_id,required:!0,children:e.jsxs("select",{value:s.data.copy_relationship_id,onChange:r=>s.setData("copy_relationship_id",r.target.value),className:o(s.errors.copy_relationship_id),required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Select copied user"}),L.map(r=>{const p=r?.user?.name||r?.user?.email||"Unknown",x=String(r?.status||"active"),h=x.charAt(0).toUpperCase()+x.slice(1),g=Number(r?.copy_ratio||0).toLocaleString(void 0,{maximumFractionDigits:2});return e.jsxs("option",{value:r.id,children:[p," · ",h," · ",g,"x"]},r.id)})]})}):null]}),e.jsx(l,{label:"Asset",error:s.errors.asset_id,required:!0,children:e.jsxs("select",{value:s.data.asset_id,onChange:r=>w(r.target.value),className:o(s.errors.asset_id),required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Select an asset"}),i.map(r=>e.jsxs("option",{value:r.id,children:[r.symbol," · ",r.name]},r.id))]})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsx(l,{label:"Side",error:s.errors.side,required:!0,children:e.jsxs("select",{value:s.data.side,onChange:r=>s.setData("side",r.target.value),className:o(s.errors.side),required:!0,children:[e.jsx("option",{value:"buy",children:"Buy"}),e.jsx("option",{value:"sell",children:"Sell"})]})}),e.jsx(l,{label:"Quantity (Leader)",error:s.errors.quantity,required:!0,children:e.jsx("input",{type:"number",step:"0.00000001",value:s.data.quantity,onChange:r=>s.setData("quantity",r.target.value),className:o(s.errors.quantity),required:!0})}),e.jsx(l,{label:"Price",error:s.errors.price,required:!0,children:e.jsx("input",{type:"number",step:"0.0001",value:s.data.price,onChange:r=>s.setData("price",r.target.value),className:o(s.errors.price),required:!0})}),e.jsx(l,{label:"Executed At",error:s.errors.executed_at,children:e.jsx("input",{type:"datetime-local",value:s.data.executed_at,onChange:r=>s.setData("executed_at",r.target.value),className:o(s.errors.executed_at)})})]}),e.jsx(l,{label:"PnL (Leader Trade)",error:s.errors.pnl,children:e.jsx("input",{type:"number",step:"0.01",value:s.data.pnl,onChange:r=>s.setData("pnl",r.target.value),className:o(s.errors.pnl),placeholder:"Optional"})}),e.jsx(l,{label:"Internal Note",error:s.errors.note,children:e.jsx("input",{type:"text",value:s.data.note,onChange:r=>s.setData("note",r.target.value),className:o(s.errors.note),placeholder:"Optional note for the metadata"})}),e.jsx("button",{type:"submit",disabled:E,className:"w-full rounded-xl bg-gradient-to-r from-emerald-500 to-cyan-500 px-5 py-2.5 text-sm font-semibold text-slate-950 transition hover:opacity-90 disabled:cursor-not-allowed disabled:opacity-60",children:s.processing?"Executing...":"Execute Trade"})]})]}),e.jsxs("section",{className:"lg:col-span-2 rounded-2xl border border-slate-800 bg-slate-900/70 p-4 sm:p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-100",children:"Trade History"}),e.jsxs("p",{className:"mt-1 text-sm text-slate-400",children:["Use ",e.jsx("strong",{children:"Execute Copy Trade"})," above to add history entries for this copy trader."]})]}),f.length===0?e.jsx("div",{className:"rounded-xl border border-slate-800 bg-slate-950/70 p-4 text-sm text-slate-400",children:"No trade history yet for this copy trader."}):e.jsx("div",{className:"space-y-3",children:f.map(r=>{const p=Number(r.pnl||0)>=0,x=r?.follower?.name||r?.follower?.email||"Unknown follower",h=r?.asset?.symbol||"N/A",g=n.data.trade_id===r.id;return e.jsxs("article",{className:"rounded-xl border border-slate-800 bg-slate-950/70 p-4",children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold text-slate-100",children:[String(r.side||"").toUpperCase()," ",h]}),e.jsxs("p",{className:"text-xs text-slate-400",children:[x," • ",r.executed_at?new Date(r.executed_at).toLocaleString():"-"]}),r?.metadata?.note?e.jsxs("p",{className:"mt-1 text-xs text-slate-500",children:["Note: ",r.metadata.note]}):null]}),e.jsx("p",{className:`text-lg font-semibold ${p?"text-emerald-400":"text-rose-400"}`,children:Number(r.pnl||0).toLocaleString(void 0,{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2})})]}),e.jsxs("div",{className:"mt-3 grid gap-2 text-xs text-slate-400 sm:grid-cols-3",children:[e.jsxs("p",{children:["Quantity: ",Number(r.quantity||0).toLocaleString()]}),e.jsxs("p",{children:["Price: ",Number(r.price||0).toLocaleString(void 0,{style:"currency",currency:"USD"})]}),e.jsxs("p",{children:["Ratio: ",r?.metadata?.copy_ratio??"-"]})]}),e.jsx("div",{className:"mt-3 border-t border-slate-800/80 pt-3",children:g?e.jsxs("form",{onSubmit:k,className:"flex flex-col gap-2 sm:flex-row sm:items-end",children:[e.jsx(l,{label:"Edit PnL (Follower)",error:n.errors.pnl,children:e.jsx("input",{type:"number",step:"0.01",value:n.data.pnl,onChange:F=>n.setData("pnl",F.target.value),className:o(n.errors.pnl),required:!0})}),e.jsxs("div",{className:"flex gap-2 pb-0.5",children:[e.jsx("button",{type:"submit",disabled:n.processing,className:"rounded-lg bg-emerald-500 px-3 py-2 text-xs font-semibold text-slate-900 transition hover:bg-emerald-400 disabled:cursor-not-allowed disabled:opacity-60",children:n.processing?"Saving...":"Save PnL"}),e.jsx("button",{type:"button",onClick:_,className:"rounded-lg border border-slate-700 px-3 py-2 text-xs font-semibold text-slate-300 transition hover:border-slate-500 hover:bg-slate-800",children:"Cancel"})]})]}):e.jsx("button",{type:"button",onClick:()=>A(r),className:"rounded-lg border border-slate-700 px-3 py-2 text-xs font-semibold text-slate-200 transition hover:border-slate-500 hover:bg-slate-800",children:"Edit PnL"})})]},r.id)})})]})]})})}function l({label:a,error:i,children:d,required:c=!1}){return e.jsxs("label",{className:"block",children:[e.jsxs("span",{className:"mb-2 block text-sm text-slate-300",children:[a," ",c?e.jsx("span",{className:"text-rose-300",children:"*"}):null]}),d,i&&e.jsx("span",{className:"mt-1 block text-xs text-rose-300",children:i})]})}function D({label:a,checked:i,onChange:d}){return e.jsxs("label",{className:"flex items-center justify-between rounded-xl border border-slate-700 bg-slate-950/70 px-4 py-3 text-sm text-slate-200",children:[e.jsx("span",{children:a}),e.jsx("button",{type:"button",onClick:()=>d(!i),className:`relative h-6 w-11 rounded-full transition ${i?"bg-emerald-500":"bg-slate-700"}`,children:e.jsx("span",{className:`absolute top-0.5 h-5 w-5 rounded-full bg-white transition ${i?"left-5":"left-0.5"}`})})]})}const o=a=>`w-full rounded-xl border px-3 py-2.5 text-sm outline-none transition ${a?"border-rose-500/60 bg-rose-500/10 text-rose-100 focus:border-rose-400":"border-slate-700 bg-slate-950 text-slate-100 focus:border-cyan-400"}`;export{V as default};
