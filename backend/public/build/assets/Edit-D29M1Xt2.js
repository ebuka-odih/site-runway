import{a as $,u as g,r as j,j as e,L as C,b as T}from"./app-B0J5p2_Z.js";import{A}from"./AdminLayout-B4GwCGzr.js";import{a as m}from"./adminPath-BxB_o4uP.js";/* empty css            */const E=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}),U=s=>{if(!s)return"";const l=new Date(s);if(Number.isNaN(l.getTime()))return"";const d=c=>String(c).padStart(2,"0");return`${l.getFullYear()}-${d(l.getMonth()+1)}-${d(l.getDate())}T${d(l.getHours())}:${d(l.getMinutes())}`},R=s=>{if(!s)return"-";const l=new Date(s);return Number.isNaN(l.getTime())?"-":l.toLocaleString()},y=s=>E.format(Number(s||0)),B=s=>{const l=Number(s||0);return l<0?`-${y(Math.abs(l))}`:y(l)};function Q({trader:s,assets:l,active_followers:d,followers:c=[],pnl_history:N=[]}){const{url:x}=$(),r=g({display_name:s.display_name||"",username:s.username||"",avatar_color:s.avatar_color||"",strategy:s.strategy||"",copy_fee:s.copy_fee??0,total_return:s.total_return??0,win_rate:s.win_rate??0,copiers_count:s.copiers_count??0,risk_score:s.risk_score??1,joined_at:U(s.joined_at),is_verified:!!s.is_verified,is_active:!!s.is_active}),v=l?.[0]??null,a=g({asset_id:v?.id||"",side:"buy",quantity:"",price:v?.price??"",executed_at:"",pnl:"",note:""}),_=c[0]?.id||"",[p,q]=j.useState(_),n=g({copy_relationship_id:_,pnl:"",executed_at:"",note:""}),h=j.useMemo(()=>c.find(t=>t.id===p)??null,[c,p]),f=j.useMemo(()=>p?N.filter(t=>t.copy_relationship_id===p):[],[N,p]),S=t=>{t.preventDefault(),r.put(m(x,`copy-traders/${s.id}`))},w=()=>{window.confirm("Delete this copy trader? This will remove all related follower relationships.")&&T.delete(m(x,`copy-traders/${s.id}`))},L=t=>{t.preventDefault(),a.post(m(x,`copy-traders/${s.id}/trades`),{preserveScroll:!0,onSuccess:()=>{a.reset("quantity","pnl","note","executed_at")}})},k=t=>{t.preventDefault(),n.data.copy_relationship_id&&n.post(m(x,`copy-traders/${s.id}/followers/pnl`),{preserveScroll:!0,onSuccess:()=>{n.reset("pnl","executed_at","note")}})},F=t=>{a.setData("asset_id",t);const u=l.find(b=>b.id===t);u&&a.setData("price",u.price)},P=t=>{q(t),n.setData("copy_relationship_id",t)};return e.jsx(A,{title:`Edit ${s.display_name}`,children:e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[1.2fr,0.8fr]",children:[e.jsxs("section",{className:"rounded-2xl border border-slate-800 bg-slate-900/70 p-6",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-100",children:"Trader Details"}),e.jsx("p",{className:"mt-1 text-sm text-slate-400",children:"Update copy trader stats and profile info."})]}),e.jsx(C,{href:m(x,"copy-traders"),className:"rounded-xl border border-slate-700 px-4 py-2 text-xs text-slate-200 transition hover:border-slate-500 hover:bg-slate-800",children:"Back to list"})]}),e.jsxs("form",{onSubmit:S,className:"space-y-5",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsx(i,{label:"Display Name",error:r.errors.display_name,required:!0,children:e.jsx("input",{type:"text",value:r.data.display_name,onChange:t=>r.setData("display_name",t.target.value),className:o(r.errors.display_name),required:!0})}),e.jsx(i,{label:"Username",error:r.errors.username,required:!0,children:e.jsx("input",{type:"text",value:r.data.username,onChange:t=>r.setData("username",t.target.value),className:o(r.errors.username),required:!0})}),e.jsx(i,{label:"Avatar Color",error:r.errors.avatar_color,children:e.jsx("input",{type:"text",value:r.data.avatar_color,onChange:t=>r.setData("avatar_color",t.target.value),className:o(r.errors.avatar_color),placeholder:"emerald"})}),e.jsx(i,{label:"Strategy",error:r.errors.strategy,required:!0,children:e.jsx("input",{type:"text",value:r.data.strategy,onChange:t=>r.setData("strategy",t.target.value),className:o(r.errors.strategy),required:!0})})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsx(i,{label:"Copy Fee ($)",error:r.errors.copy_fee,required:!0,children:e.jsx("input",{type:"number",step:"0.01",min:"0",value:r.data.copy_fee,onChange:t=>r.setData("copy_fee",t.target.value),className:o(r.errors.copy_fee),required:!0})}),e.jsx(i,{label:"Total Return (%)",error:r.errors.total_return,required:!0,children:e.jsx("input",{type:"number",step:"0.01",value:r.data.total_return,onChange:t=>r.setData("total_return",t.target.value),className:o(r.errors.total_return),required:!0})}),e.jsx(i,{label:"Win Rate (%)",error:r.errors.win_rate,required:!0,children:e.jsx("input",{type:"number",step:"0.01",value:r.data.win_rate,onChange:t=>r.setData("win_rate",t.target.value),className:o(r.errors.win_rate),required:!0})}),e.jsx(i,{label:"Copiers Count",error:r.errors.copiers_count,required:!0,children:e.jsx("input",{type:"number",step:"1",value:r.data.copiers_count,onChange:t=>r.setData("copiers_count",t.target.value),className:o(r.errors.copiers_count),required:!0})}),e.jsx(i,{label:"Risk Score (1-10)",error:r.errors.risk_score,required:!0,children:e.jsx("input",{type:"number",step:"1",min:"1",max:"10",value:r.data.risk_score,onChange:t=>r.setData("risk_score",t.target.value),className:o(r.errors.risk_score),required:!0})})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:e.jsx(i,{label:"Joined At",error:r.errors.joined_at,required:!0,children:e.jsx("input",{type:"datetime-local",value:r.data.joined_at,onChange:t=>r.setData("joined_at",t.target.value),className:o(r.errors.joined_at),required:!0})})}),e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[e.jsx(D,{label:"Verified",checked:r.data.is_verified,onChange:t=>r.setData("is_verified",t)}),e.jsx(D,{label:"Active",checked:r.data.is_active,onChange:t=>r.setData("is_active",t)})]}),(r.errors.is_verified||r.errors.is_active)&&e.jsx("p",{className:"text-xs text-rose-300",children:r.errors.is_verified||r.errors.is_active}),e.jsxs("div",{className:"flex flex-wrap gap-3 pt-2",children:[e.jsx("button",{type:"submit",disabled:r.processing,className:"rounded-xl bg-gradient-to-r from-cyan-500 to-emerald-500 px-5 py-2.5 text-sm font-semibold text-slate-950 transition hover:opacity-90 disabled:cursor-not-allowed disabled:opacity-60",children:r.processing?"Saving...":"Save Changes"}),e.jsx(C,{href:m(x,"copy-traders"),className:"rounded-xl border border-slate-700 px-5 py-2.5 text-sm text-slate-200 transition hover:border-slate-500 hover:bg-slate-800",children:"Cancel"}),e.jsx("button",{type:"button",onClick:w,className:"rounded-xl border border-rose-500/50 px-5 py-2.5 text-sm font-semibold text-rose-200 transition hover:border-rose-400 hover:bg-rose-500/10",children:"Delete Trader"})]})]})]}),e.jsxs("section",{className:"rounded-2xl border border-slate-800 bg-slate-900/70 p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-100",children:"Execute Copy Trade"}),e.jsxs("p",{className:"mt-1 text-sm text-slate-400",children:["Applies the trade to ",d," active follower",d===1?"":"s",". Quantity and PnL scale by each follower's copy ratio."]})]}),e.jsxs("form",{onSubmit:L,className:"space-y-4",children:[e.jsx(i,{label:"Asset",error:a.errors.asset_id,required:!0,children:e.jsxs("select",{value:a.data.asset_id,onChange:t=>F(t.target.value),className:o(a.errors.asset_id),required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Select an asset"}),l.map(t=>e.jsxs("option",{value:t.id,children:[t.symbol," Â· ",t.name]},t.id))]})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsx(i,{label:"Side",error:a.errors.side,required:!0,children:e.jsxs("select",{value:a.data.side,onChange:t=>a.setData("side",t.target.value),className:o(a.errors.side),required:!0,children:[e.jsx("option",{value:"buy",children:"Buy"}),e.jsx("option",{value:"sell",children:"Sell"})]})}),e.jsx(i,{label:"Quantity (Leader)",error:a.errors.quantity,required:!0,children:e.jsx("input",{type:"number",step:"0.00000001",value:a.data.quantity,onChange:t=>a.setData("quantity",t.target.value),className:o(a.errors.quantity),required:!0})}),e.jsx(i,{label:"Price",error:a.errors.price,required:!0,children:e.jsx("input",{type:"number",step:"0.0001",value:a.data.price,onChange:t=>a.setData("price",t.target.value),className:o(a.errors.price),required:!0})}),e.jsx(i,{label:"Executed At",error:a.errors.executed_at,children:e.jsx("input",{type:"datetime-local",value:a.data.executed_at,onChange:t=>a.setData("executed_at",t.target.value),className:o(a.errors.executed_at)})})]}),e.jsx(i,{label:"PnL (Leader Trade)",error:a.errors.pnl,children:e.jsx("input",{type:"number",step:"0.01",value:a.data.pnl,onChange:t=>a.setData("pnl",t.target.value),className:o(a.errors.pnl),placeholder:"Optional"})}),e.jsx(i,{label:"Internal Note",error:a.errors.note,children:e.jsx("input",{type:"text",value:a.data.note,onChange:t=>a.setData("note",t.target.value),className:o(a.errors.note),placeholder:"Optional note for the metadata"})}),e.jsx("button",{type:"submit",disabled:a.processing||d===0,className:"w-full rounded-xl bg-gradient-to-r from-emerald-500 to-cyan-500 px-5 py-2.5 text-sm font-semibold text-slate-950 transition hover:opacity-90 disabled:cursor-not-allowed disabled:opacity-60",children:a.processing?"Executing...":"Execute Trade"})]})]}),e.jsxs("section",{className:"lg:col-span-2 rounded-2xl border border-slate-800 bg-slate-900/70 p-6",children:[e.jsxs("div",{className:"mb-5",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-100",children:"Follower PnL History"}),e.jsxs("p",{className:"mt-1 text-sm text-slate-400",children:["Select a copied user, click ",e.jsx("strong",{children:"Edit PnL"}),", and create manual Profit/Loss history entries."]})]}),c.length===0?e.jsx("div",{className:"rounded-xl border border-slate-800 bg-slate-950/80 p-6 text-sm text-slate-400",children:"This trader has no copied users yet."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto rounded-xl border border-slate-800",children:e.jsxs("table",{className:"w-full text-left text-sm text-slate-300",children:[e.jsx("thead",{className:"bg-slate-950/80 text-xs uppercase tracking-wide text-slate-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"User"}),e.jsx("th",{className:"px-4 py-3",children:"Status"}),e.jsx("th",{className:"px-4 py-3",children:"Copy Ratio"}),e.jsx("th",{className:"px-4 py-3",children:"Current PnL"}),e.jsx("th",{className:"px-4 py-3",children:"Trades"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-800",children:c.map(t=>{const u=t.user?.name||t.user?.username||t.user?.email||"Unknown user",b=p===t.id;return e.jsxs("tr",{className:"bg-slate-950/60",children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("p",{className:"font-medium text-slate-100",children:u}),t.user?.email&&e.jsx("p",{className:"text-xs text-slate-500",children:t.user.email})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(H,{status:t.status})}),e.jsxs("td",{className:"px-4 py-3",children:[Number(t.copy_ratio).toFixed(2),"x"]}),e.jsx("td",{className:"px-4 py-3",children:y(t.pnl)}),e.jsx("td",{className:"px-4 py-3",children:t.trades_count}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("button",{type:"button",onClick:()=>P(t.id),className:`rounded-lg px-3 py-1.5 text-xs font-semibold transition ${b?"bg-blue-600 text-white":"bg-blue-500/20 text-blue-100 hover:bg-blue-500/30"}`,children:"Edit PnL"})})]},t.id)})})]})}),n.errors.copy_relationship_id&&e.jsx("p",{className:"mt-3 text-xs text-rose-300",children:n.errors.copy_relationship_id}),e.jsxs("div",{className:"mt-6 grid gap-6 lg:grid-cols-[0.85fr,1.15fr]",children:[e.jsxs("section",{className:"rounded-xl border border-slate-800 bg-slate-950/70 p-5",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:"Create PnL Entry"}),e.jsx("p",{className:"mt-1 text-xs text-slate-400",children:h?`Selected user: ${h.user?.name||h.user?.username||h.user?.email||"Unknown user"}`:"Select a user first."})]}),e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsx(i,{label:"PnL Amount",error:n.errors.pnl,required:!0,children:e.jsx("input",{type:"number",step:"0.01",value:n.data.pnl,onChange:t=>n.setData("pnl",t.target.value),className:o(n.errors.pnl),placeholder:"Use + for profit and - for loss",required:!0})}),e.jsx(i,{label:"Date & Time",error:n.errors.executed_at,children:e.jsx("input",{type:"datetime-local",value:n.data.executed_at,onChange:t=>n.setData("executed_at",t.target.value),className:o(n.errors.executed_at)})}),e.jsx(i,{label:"Note",error:n.errors.note,children:e.jsx("input",{type:"text",value:n.data.note,onChange:t=>n.setData("note",t.target.value),className:o(n.errors.note),placeholder:"Optional internal note"})}),e.jsx("button",{type:"submit",disabled:n.processing||!n.data.copy_relationship_id,className:"w-full rounded-xl bg-blue-600 px-4 py-2.5 text-sm font-semibold text-white transition hover:bg-blue-500 disabled:cursor-not-allowed disabled:opacity-60",children:n.processing?"Saving...":"Add PnL History"})]})]}),e.jsxs("section",{className:"rounded-xl border border-slate-800 bg-slate-950/70 p-5",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-slate-500",children:"Performance"}),e.jsx("h3",{className:"mt-1 text-2xl font-bold text-slate-100",children:"PnL History"})]}),e.jsx("div",{className:"space-y-3",children:f.length===0?e.jsx("div",{className:"rounded-xl border border-slate-800 bg-slate-950 p-4 text-sm text-slate-400",children:"No PnL history entries for this user yet."}):f.map(t=>{const u=String(t.entry_type||"").toLowerCase()==="profit"||Number(t.pnl)>=0;return e.jsxs("article",{className:"flex items-center justify-between rounded-xl border border-slate-800 bg-slate-950 p-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:`mt-1 h-3 w-3 rounded-full ${u?"bg-emerald-400":"bg-rose-400"}`}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-slate-100",children:u?"Profit":"Loss"}),e.jsx("p",{className:"text-sm text-slate-400",children:R(t.executed_at)}),t.note&&e.jsx("p",{className:"mt-1 text-xs text-slate-500",children:t.note})]})]}),e.jsx("p",{className:`text-xl font-semibold ${u?"text-emerald-400":"text-rose-400"}`,children:B(t.pnl)})]},t.id)})})]})]})]})]})]})})}function i({label:s,error:l,children:d,required:c=!1}){return e.jsxs("label",{className:"block",children:[e.jsxs("span",{className:"mb-2 block text-sm text-slate-300",children:[s," ",c?e.jsx("span",{className:"text-rose-300",children:"*"}):null]}),d,l&&e.jsx("span",{className:"mt-1 block text-xs text-rose-300",children:l})]})}function D({label:s,checked:l,onChange:d}){return e.jsxs("label",{className:"flex items-center justify-between rounded-xl border border-slate-700 bg-slate-950/70 px-4 py-3 text-sm text-slate-200",children:[e.jsx("span",{children:s}),e.jsx("button",{type:"button",onClick:()=>d(!l),className:`relative h-6 w-11 rounded-full transition ${l?"bg-emerald-500":"bg-slate-700"}`,children:e.jsx("span",{className:`absolute top-0.5 h-5 w-5 rounded-full bg-white transition ${l?"left-5":"left-0.5"}`})})]})}function H({status:s}){const l=s==="active"||s==="paused"||s==="closed"?s:"paused",d=l==="active"?"border-emerald-500/40 bg-emerald-500/10 text-emerald-200":l==="paused"?"border-amber-500/40 bg-amber-500/10 text-amber-200":"border-slate-700 text-slate-300";return e.jsx("span",{className:`rounded-full border px-2 py-1 text-[10px] uppercase ${d}`,children:l})}const o=s=>`w-full rounded-xl border px-3 py-2.5 text-sm outline-none transition ${s?"border-rose-500/60 bg-rose-500/10 text-rose-100 focus:border-rose-400":"border-slate-700 bg-slate-950 text-slate-100 focus:border-cyan-400"}`;export{Q as default};
